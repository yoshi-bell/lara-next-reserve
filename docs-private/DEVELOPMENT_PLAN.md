# lara-next-reserve 開発計画書 (改訂版)

## 0. ドキュメント運用方針 (Meta Rules for AI Agent)

本計画書は、AIエージェントと人間が協働で開発を進める上での**不変の原則（憲法）**を定義する。AIエージェントは以下のドキュメント構成を理解し、それぞれの役割に応じて行動すること。

*   **本ドキュメント (`DEVELOPMENT_PLAN.md`):**
    *   **役割:** プロジェクトの「憲法」。設計思想、技術選定、重要事項、各種ガイドラインなど、常に遵守すべき**静的ルール**を記述する。
    *   **扱い:** タスク実行前に必ず参照し、制約条件として常に意識すること。原則として、このファイルは頻繁には変更されない。

*   **`WORKFLOW.md`:**
    *   **役割:** プロジェクトの「手順書」。具体的な開発タスクを記述した**動的なチェックリスト**。
    *   **扱い:** タスクに着手する際は、このファイルのチェックリストに従って作業を進め、完了の定義（実装・動作確認・プロセス記録）を満たした場合にのみチェックを入れること。

*   **`DEV_LOG.md`:**
    *   **役割:** プロジェクトの「航海日誌」。日々の開発プロセス、技術的判断、エラー解決の経緯などを記録する。

*   **`AGENT_RECOVERY_MANUAL.md`:**
    *   **役割:** プロジェクトの「復旧マニュアル」。コンテキストがリセットされた場合に、AIエージェントが迅速に現状を把握するための手順書。

---

## 1. 設計概念 (Core Concepts)

### アーキテクチャ
*   **完全分離構成:** フロントエンド (Next.js) と バックエンド (Laravel API) を疎結合にする。
*   **ステートフル認証:** SPA認証には **Laravel Sanctum (手動設定)** と **Axios** を採用し、Cookieベースのセッション管理を行う。

### 開発方針
*   **機能優先 (Function First):** UIの装飾よりも、データの正確な流れと機能の実装を最優先する。
*   **画面逆算設計 (UI-Driven API):** APIのエンドポイントやレスポンス構造は、画面に必要なデータから逆算して決定する。
*   **堅牢性:** データベースレベルでの制約（複合ユニークキー等）を活用し、データの整合性を担保する。

---

## 2. 重要事項 (Critical Points)

### データベース
*   **複合ユニーク制約:** `reservations` テーブルの `(user_id, start_at)` および `favorites` テーブルの `(user_id, shop_id)` には必ず設定する。
*   **論理削除:** 予約キャンセルは `deleted_at` (SoftDeletes) を使用し、履歴を残す。

### バリデーション
*   **重複予約防止:** DBのユニーク制約に加え、FormRequestクラスで「時間の重複（開始〜終了時間が被る予約）」をチェックするロジックを実装する。

### 非同期処理
*   **リアルタイム性:** 検索フォーム、お気に入り登録、予約空席確認は、画面遷移を伴わない非同期通信 (**SWR** / Axios) で実装する。

### Git運用ルール
*   **ドキュメント管理:**
    *   開発中の設計資料（CSV, 開発計画書）やこの開発ログは `docs-private/` に配置。バックアップしておく
    *   開発完了後は`.gitignore` に追加し、リモートリポジトリには公開しない運用とする。その際にGoogleドライブにパックアップ機能を移設
*   **コミット:**
    *   日本語のプレフィックス付きメッセージ（例: `feat:`, `docs:`）でコミットする。

---

## 3. フロントエンド実装ガイドライン (Tailwind CSS)

### 基本方針
*   **モバイルファースト (Mobile First):**
    *   基本スタイルはスマホ（最小画面）向けに記述する。
    *   PC向けのスタイルは `md:`, `lg:` などのプレフィックスを用いて上書きする。

### スタイリングルール
*   **ユーティリティファースト:**
    *   CSSファイルへの記述は避け、JSX内の `className` に直接記述する。
    *   `@apply` の使用は原則禁止し、再利用が必要な場合は **Reactコンポーネント化** で対応する。
*   **自動整形:**
    *   `prettier-plugin-tailwindcss` を導入し、クラス名の並び順を自動で統一する。