# 🔵 メタ定義: このファイルの責務 (AIエージェント用)
> **AIエージェントへの指示 (Prompt Repetition Strategy):** 
> このファイルはプロジェクトの「設計図」であり「憲法」です。
> 実装を開始する前に、内容を**「合計2回」**読み込み、不変の原則（疎結合・画面逆算設計・DB制約）を完全に理解してください。

*   **役割:** プロジェクトの「仕様」「設計方針」「不変の原則」の定義。
*   **読むべきタイミング:** 新しい機能の実装、DB変更、または設計上の判断が必要な時。
*   **思考の優先順位:** 設計と方針に関して最優先。ここにある原則に反するコードを書いてはならない。
*   **含まない情報:** 具体的なタスクの進捗（WORKFLOW.md を参照）、過去の変更履歴（DEV_LOG.md を参照）。

---

# lara-next-reserve 開発計画書 (改訂版)

## ⚖️ プロジェクト憲法 (The Constitution)
> **警告:** 以下のルールは、本プロジェクトにおいて**最優先される絶対的な制約**である。
> AIエージェントは独自の判断でこれに違反する提案や実装を行ってはならない。

1.  **言語とコミットの遵守 (Language & Commit Rules):**
    *   思考、応答、ドキュメント記述はすべて**日本語**で行うこと。
    *   Gitコミットメッセージは「日本語」かつ「プレフィックス（`feat:`, `fix:`, `docs:`, `test:`, `chore:`, `refactor:`）」を必ず使用すること。
2.  **品質の保証 (Testing & Verification):**
    *   新機能の実装やリファクタリングを行う際は、必ず対応するテストコード（Feature Test）を作成・実行し、既存の機能を破壊していないことを証明すること。
3.  **整合性の維持 (Documentation Sync):**
    *   `git push` を行う直前に、必ず `DEV_LOG.md` と `AGENT_RECOVERY_MANUAL.md` を更新し、実装とドキュメントを同期させること（詳細は `WORKFLOW.md` 参照）。
4.  **シンプルさの追求 (YAGNI):**
    *   「将来使うかもしれない」という理由で過剰な機能やコードを追加しないこと。現在の要件を満たす最もシンプルでクリーンな実装を選択すること。

---

## 🏗️ アーキテクチャと設計思想 (Architecture & Philosophy)

### アーキテクチャ
*   **完全分離構成:** フロントエンド (Next.js) と バックエンド (Laravel API) を疎結合にする。
*   **ステートフル認証:** SPA認証には **Laravel Sanctum (手動設定)** と **Axios** を採用し、Cookieベースのセッション管理を行う。

### 開発方針
*   **機能優先 (Function First):** UIの装飾よりも、データの正確な流れと機能の実装を最優先する。
*   **画面逆算設計 (UI-Driven API):** APIのエンドポイントやレスポンス構造は、画面に必要なデータから逆算して決定する。

---

## 🔒 技術仕様と重要ルール (Technical Specs & Rules)

### データベース設計
*   **整合性の担保:**
    *   `reservations` テーブル: `(user_id, start_at)` に複合ユニーク制約を設定。
    *   `favorites` テーブル: `(user_id, shop_id)` に複合ユニーク制約を設定。
*   **論理削除:** 予約キャンセルは `deleted_at` (SoftDeletes) を使用し、物理削除は行わない。

### バリデーション
*   **多層防御:** フロントエンドでのチェックに加え、FormRequestクラスで「時間の重複」や「定員オーバー」を厳密にチェックするロジックを実装する。

### Git運用とドキュメント管理
*   **プライベート資料:** 設計資料、CSV、開発ログは `docs-private/` で一元管理する。
*   **公開とバックアップ:** 開発完了後は `docs-private/` を `.gitignore` に追加して非公開とし、Googleドライブ等の外部ストレージにバックアップを退避させる。

---

## 🎨 実装ガイドライン (Implementation Guidelines)

### フロントエンド (Next.js / Tailwind CSS)
*   **自動整形:** `prettier-plugin-tailwindcss` を導入・適用し、クラス名の並び順を自動で統一すること。
*   **スタイリング:** モバイルファーストを徹底し、ユーティリティクラス (`className`) に直接記述する。`@apply` は原則禁止。
*   **コンポーネント設計:** 再利用可能なパーツはコンポーネント化し、単一責任の原則を守る。

### バックエンド (Laravel)
*   **命名規則:** クラス名は `PascalCase`、メソッド・変数は `camelCase`、DBカラムは `snake_case` を厳守。
*   **クリーンコード:** コントローラーの責務を最小限に抑え、バリデーションは FormRequest に集約する。

---

## 📂 ドキュメント構成 (Documentation Structure)

*   **`WORKFLOW.md`:** 開発の手順書・チェックリスト（作業時はこれを常に見る）。
*   **`DEV_LOG.md`:** 開発の航海日誌・変更履歴。
*   **`AGENT_RECOVERY_MANUAL.md`:** エージェントの初期化・復旧マニュアル。
